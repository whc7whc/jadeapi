@model IEnumerable<Team.Backend.Models.ViewModels.SellerFullViewModel>
@Html.AntiForgeryToken()
<style>
    .input-group-lg > .form-control {
        font-size: 1.25rem; /* 加大輸入框字體 */
        border-top-right-radius: 0;
        border-bottom-right-radius: 0;
    }

    .input-group-lg > .btn,
    .input-group-lg > a.btn {
        font-size: 1.1rem;
        padding: 0.5rem 1rem;
        border-top-left-radius: 0;
        border-bottom-left-radius: 0;
    }

    .input-group-lg > a.btn {
        border-left: none;
        margin-left: 2px;
    }

    /* 按鈕 hover 效果 */
    .btn-primary:hover {
        background-color: #004085;
        border-color: #004085;
    }

    .btn-outline-secondary:hover {
        background-color: #e2e6ea;
        border-color: #dae0e5;
    }

</style>
<!-- 引入自訂樣式及 DataTables、Bootstrap Icons -->
<link rel="stylesheet" href="~/css/MemberInfo.css" />
<link href="~/vendor/datatables/dataTables.bootstrap4.min.css" rel="stylesheet" />
<link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

<div id="seller-tab" class="tab-content active">
    <div class="table-container">
        <form method="get" asp-controller="SellerManage" asp-action="SellerInfo" class="mb-4">
            <div class="input-group input-group-lg rounded shadow-sm">
                <input type="text" name="search" class="form-control border-primary" placeholder="搜尋姓名、信箱、身份證..." value="@ViewBag.CurrentSearch" aria-label="搜尋" />
                <button class="btn btn-primary d-flex align-items-center" type="submit">
                    <i class="bi bi-search me-2"></i> 搜尋
                </button>
                <a href="@Url.Action("SellerInfo", "SellerManage")" class="btn btn-outline-secondary d-flex align-items-center" style="border-top-left-radius: 0; border-bottom-left-radius: 0;">
                    <i class="bi bi-x-lg me-1"></i> 清除
                </a>
            </div>
        </form>




        <!-- 賣家列表資料表 -->
        <table id="sellerTable" class="table table-bordered" width="100%" cellspacing="0">
            <thead>
                <tr>
                    <!-- 表頭欄位 -->
                    <th style="text-align: center;">姓名</th>
                    <th style="text-align: center;">信箱</th>
                    <th style="text-align: center;">身份證號</th>
                    <th style="text-align: center;">申請狀態</th>
                    <th style="text-align: center;">申請時間</th>
                    <th style="text-align: center;">操作</th>
                </tr>
            </thead>
            <tbody>
                <!-- 逐筆渲染賣家資料 -->
                @foreach (var seller in Model)
                {
                    <tr style="text-align: center">
                        <td>@seller.RealName</td> <!-- 賣家姓名 -->
                        <td>@seller.Email</td> <!-- 賣家 Email -->
                        <td>
                            @{
                                var id = seller.IdNumber;
                                var maskedId = id.Length >= 10
                                ? id.Substring(0, 3) + "****" + id.Substring(id.Length - 2)
                                : id; // 若長度不符就直接顯示原始
                            }
                            @maskedId
                        </td> <!-- 身份證字號 -->
                        <td>
                            <!-- 依申請狀態顯示不同顏色徽章 -->
                            @switch (seller.ApplicationStatus)
                            {
                                case "pending":
                                    <span class="badge fs-1 px-2 py-2 bg-warning text-dark">待審核</span>
                                    break;
                                case "approved":
                                    <span class="badge fs-1 px-2 py-2 bg-success text-white">已通過</span>
                                    break;
                                case "rejected":
                                    <span class="badge fs-1 px-2 py-2 bg-danger text-white">已拒絕</span>
                                    break;
                                case "resubmitted":
                                    <span class="badge fs-1 px-2 py-2 bg-info text-white">重新申請</span>
                                    break;
                            }

                        </td>
                        <td>@seller.SellerAppliedAt.ToString("yyyy-MM-dd HH:mm")</td> <!-- 申請時間，格式化 -->
                        <td>
                            <div class="d-flex align-items-center flex-wrap justify-content-center">
                                <button type="button" class="btn btn-primary btn-sm d-flex align-items-center m-1" onclick="showSellerDetail(@seller.SellerId)">
                                    <i class="bi bi-eye me-1"></i> 查看&審核
                                </button>
                            </div>
                        </td>

                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<!-- 賣家詳細資料 Modal -->
<div class="modal fade" id="sellerDetailModal" tabindex="-1" aria-labelledby="sellerDetailModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content" id="sellerDetailContent">
            <!-- 內容將由 AJAX 載入 -->
        </div>
    </div>
</div>
<nav aria-label="賣家分頁" class="mt-3">
    <ul class="pagination justify-content-center">
        <li class="page-item @(ViewBag.CurrentPage == 1 ? "disabled" : "")">
            <a class="page-link" href="?search=@ViewBag.CurrentSearch&page=@(ViewBag.CurrentPage - 1)">上一頁</a>
        </li>

        @for (int i = 1; i <= ViewBag.TotalPages; i++)
        {
            <li class="page-item @(ViewBag.CurrentPage == i ? "active" : "")">
                <a class="page-link" href="?search=@ViewBag.CurrentSearch&page=@i">@i</a>
            </li>
        }

        <li class="page-item @(ViewBag.CurrentPage == ViewBag.TotalPages ? "disabled" : "")">
            <a class="page-link" href="?search=@ViewBag.CurrentSearch&page=@(ViewBag.CurrentPage + 1)">下一頁</a>
        </li>
    </ul>
</nav>


@section Scripts {
    <!-- 引入 jQuery、Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        $(document).ready(function () {
            $('#sellerTable').DataTable({
                paging: false,       // 關閉 DataTables 分頁，自己用 Razor 分頁
                info: false,
                searching: false,    // 關閉 DataTables 搜尋，自己用 Razor 搜尋
                ordering: true,      // 啟用排序（預設是 true，可以省略）
                order: [[4, 'desc']], // 預設依「申請時間」欄（第5欄）排序，降冪
                columnDefs: [
                    { orderable: false, targets: 5 } // 禁止「操作」欄排序
                ]
            });
        });
    </script>
    <script>
        // 全局函式：顯示賣家詳細資料 Modal
        function showSellerDetail(sellerId) {
            $.get('/SellerManage/SellerDetail', { id: sellerId }, function (result) {
                $('#sellerDetailContent').html(result);
                const detailModal = new bootstrap.Modal(document.getElementById('sellerDetailModal'));
                detailModal.show();
            }).fail(function() {
                alert('載入賣家詳細資料失敗');
            });
        }

        $(document).ready(function () {
            // 如果未來要用到防偽驗證 Token 或其他初始化可以寫在這裡
            // 例如:
            // var antiForgeryToken = $('input[name="__RequestVerificationToken"]').val();
        });
    </script>
}

