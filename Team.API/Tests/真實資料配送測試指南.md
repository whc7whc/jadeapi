# 🚚 **真實資料配送測試指南**

## 📋 **測試前準備**

### **1. 插入真實物流商資料**
```sql
-- 在 SQL Server 中執行
INSERT INTO Carriers (Name, Contact, CreatedAt) VALUES
('黑貓宅急便', '客服專線: 0800-200-777', GETDATE()),
('7-11 超商取貨', '客服專線: 0800-008-711', GETDATE()),
('全家便利商店', '客服專線: 0800-030-588', GETDATE());
```

### **2. 啟動 Team.API**
```bash
cd Team.API
dotnet run
```

---

## 🧪 **配送選項測試**

### **測試案例 1：基本配送選項（使用真實會員）**

#### **前置檢查**
```sql
-- 確認您有真實的會員資料
SELECT Id, Email, Level FROM Members WHERE Id = 1;

-- 確認會員有購物車資料
SELECT COUNT(*) FROM CartItems ci 
JOIN Carts c ON c.Id = ci.CartId 
WHERE c.MemberId = 1;
```

#### **API 測試**
```http
GET https://localhost:7106/api/Checkout/delivery-methods/1
```

#### **預期結果**
```json
{
  "success": true,
  "data": [
    {
      "method": "HOME_TCAT",
      "name": "黑貓宅急便",
      "fee": 65,
      "description": "黑貓宅急便到府配送 - 1-2個工作天",
      "isAvailable": true,
      "estimatedDays": 2
    },
    {
      "method": "UNIMART",
      "name": "7-ELEVEN 超商取貨",
      "fee": 60,
      "description": "7-ELEVEN 超商取貨付款 - 2-4個工作天",
      "isAvailable": true,
      "estimatedDays": 3
    },
    {
      "method": "FAMI",
      "name": "全家便利商店取貨",
      "fee": 60,
      "description": "全家便利商店取貨付款 - 2-4個工作天",
      "isAvailable": true,
      "estimatedDays": 3
    }
  ]
}
```

---

### **測試案例 2：金牌會員優惠（如果您有金牌會員）**

#### **檢查會員等級**
```sql
-- 查看會員等級
SELECT m.Id, m.Email, m.Level, ml.LevelName 
FROM Members m 
LEFT JOIN MembershipLevels ml ON ml.Id = m.Level 
WHERE m.Id = 1;
```

#### **如果是金牌會員，預期結果**
運費會自動折扣 20 元，描述會加上 "(金牌會員優惠)"

---

### **測試案例 3：滿千免運**

#### **檢查購物車金額**
```sql
-- 查看購物車小計
SELECT 
    c.MemberId,
    SUM(ci.PriceAtAdded * ci.Quantity) as Subtotal
FROM Carts c
JOIN CartItems ci ON ci.CartId = c.Id
WHERE c.MemberId = 1
GROUP BY c.MemberId;
```

#### **如果小計 >= 1000，預期結果**
所有配送方式的運費都會變為 0，描述會加上 "(滿千免運)"

---

### **測試案例 4：運費計算 API**

```http
# 測試各種配送方式
GET https://localhost:7106/api/Checkout/shipping-fee/1?deliveryMethod=HOME_TCAT
GET https://localhost:7106/api/Checkout/shipping-fee/1?deliveryMethod=UNIMART  
GET https://localhost:7106/api/Checkout/shipping-fee/1?deliveryMethod=FAMI
```

---

### **測試案例 5：地址限制（如果您有離島地址）**

#### **檢查會員地址**
```sql
-- 查看會員地址
SELECT Id, MembersId, City, District, StreetAddress 
FROM MemberAddresses 
WHERE MembersId = 1;
```

#### **測試離島地址（如果有）**
```http
GET https://localhost:7106/api/Checkout/delivery-methods/1?addressId={地址ID}
```

---

## 🎯 **完整結帳流程測試**

### **使用真實會員資料建立訂單**

```http
POST https://localhost:7106/api/Checkout/create-order
Content-Type: application/json

{
  "memberId": 1,
  "recipientName": "測試收件人",
  "phoneNumber": "0912345678", 
  "city": "台北市",
  "district": "中正區",
  "addressDetail": "測試地址123號",
  "deliveryMethod": "HOME_TCAT",
  "paymentMethod": "credit_card",
  "couponCode": "",
  "usedPoints": 0,
  "note": "API測試訂單"
}
```

---

## 📊 **檢查點**

### **✅ 必須驗證的項目**

1. **資料庫連接**
   - [ ] API 能正確讀取 Carriers 表
   - [ ] 會員等級關聯正確（Member.Level → MembershipLevel.Id）

2. **配送選項**
   - [ ] 三個物流商都正確顯示
   - [ ] 運費計算正確
   - [ ] 綠界代碼正確對應

3. **業務邏輯**
   - [ ] 會員等級優惠（如適用）
   - [ ] 滿千免運（如適用）
   - [ ] 地址限制（如適用）

4. **訂單建立**
   - [ ] 能使用綠界代碼建立訂單
   - [ ] deliveryMethod 正確儲存

---

## 🔧 **常見問題**

### **Q: 配送選項為空**
**檢查：**
```sql
SELECT COUNT(*) FROM Carriers;
```
如果為 0，請執行插入物流商的 SQL

### **Q: 會員等級優惠無效**
**檢查：**
```sql
SELECT m.Level, ml.LevelName 
FROM Members m 
LEFT JOIN MembershipLevels ml ON ml.Id = m.Level 
WHERE m.Id = 1;
```

### **Q: 運費計算錯誤**
**檢查購物車資料：**
```sql
SELECT SUM(ci.PriceAtAdded * ci.Quantity) as CartTotal
FROM Carts c
JOIN CartItems ci ON ci.CartId = c.Id
WHERE c.MemberId = 1;
```

---

## 🎉 **測試成功指標**

- ✅ 配送選項從資料庫正確讀取
- ✅ 運費計算邏輯正確
- ✅ 會員等級優惠正確應用
- ✅ 滿千免運正確觸發  
- ✅ 訂單可以成功建立
- ✅ 使用綠界物流代碼

**完成這些測試後，您的配送系統就可以整合綠界物流 API 了！** 🚀